# Решение тестового задания

Задача: выполнить разбор файла почтового лога, залить данные в БД и организовать поиск по адресу получателя. Выполнил: Гриценко Вячеслав. Ниже представлены решённые подзадачи с комментариями по ходу решения. 

## Анализ задачи

1. Так как в задании требуется формировать список `<timestamp> <строка лога>` именно из *двух* таблиц, а в таблице `message` отсутствует адрес получателя, связь между таблицами должна осуществляться по полю `int_id`. В ходе ручного анализа файла лога, выяснилось, что в файле очень много записей с одинаковыми `int_id` для одного адреса получателя (напр. `udbbwscdnbegrmloghuf@london.com`), поэтому для второй части задания, поскольку явно не указано, будут выбираться: записи с адресом назначения из `log` и о приеме сообщения из `message` по соответствующему `int_id`. Сообщения с таким же `int_id`, но другим адресом получателя из `log` выбираться не будут.
2. Так как во втором пункте требуется создать html страницу и уметь обрабатывать посылаемую форму, необходимо использовать какой-нибудь модуль для организации веб-сервисов. Поскольку в интернете есть много примеров с Perl модулем `Mojolicious`, в данном задании для этого буду использовать именно его.
3. Так как в задании приведена схема базы данных в формате PostgreSQL, эта СУБД была выбрана для реализации задания.
4. Так как принято решение использовать `Mojolicious`, для взаимодействия с БД буду использовать модуль `Mojo::Pg`, для которого есть понятные примеры использования на github.
5. Чтобы не писать разный код взаимодействия с БД, для первой части задания (обработчика логов) тоже буду использовать `Mojo::Pg`.

## Подготовка окружения

На систему была установлена СУБД и создан пользователь с именем `user1` и паролем `12345`
Установка PostgreSQL:
```
$ sudo apt install postgresql postgresql-contrib libpq-dev`
```
Проверка, что СУБД установлена и запущена:
```
$ sudo systemctl status postgresql
```
Запускаем клиент PostgreSQL от имени пользователя postgres:
```
$ sudo -u postgres psql
```
Создание БД для тестового задания:
```
postgres=# create database test;
```
Создание пользователя с паролем:
```
postgres=# create user user1 with password '12345';
```
Назначение пользователю прав доступа к базе:
```
postgres=# grant all privileges on database test to user1;
```
Подключимся к СУБД от имени созданного пользователя:
```
$ psql -h localhost -U user1 test
```
Затем, используя SQL запросы из задания были созданы две таблицы.
С помощью cpan установлен модуль Mojolicious и Mojo::Pg:
```
$ cpan install Mojolicious Mojo::Pg
```
При первом запуске cpan, была выбрана автоматическая конфигурация cpan с sudo, чтобы пакеты ставились глобально для всей системы.

## Реализация обеих частей

Обе части задания реализованы в отдельных файлах: `part1.pl` и `part2.pl`. 
Написан скрипт `run.sh`, который выводит команды для запуска обеих частей.
